- name: Update pip & related tools
  pip:
    name:
      - pip
      - setuptools
      - wheel
    state: latest
    virtualenv: "{{ virtualenv_path }}"
    virtualenv_python: "{{ openwisp2_python }}"
  retries: 3
  delay: 5
  register: result
  until: result is success

- name: Install Python dependencies from requirements.txt
  pip:
    requirements: "{{ role_path }}/files/requirements.txt"
    state: present
    virtualenv: "{{ virtualenv_path }}"
    virtualenv_python: "{{ openwisp2_python }}"
  environment:
    LC_CTYPE: "en_US.UTF-8"
  notify: Reload application
  retries: 5
  delay: 10
  register: result
  until: result is success

- name: Install extra python packages
  pip:
    name: "{{ openwisp2_extra_python_packages }}"
    state: present
    virtualenv: "{{ virtualenv_path }}"
    virtualenv_python: "{{ openwisp2_python }}"
  when: openwisp2_extra_python_packages | length > 0
  retries: 3
  delay: 5
  register: result
  until: result is success
  notify: Reload application
  tags: [extra_pip]

---


- name: Show Clean Insights measurement collection disclaimer
  debug:
    msg: |
      By continuing with the ongoing installation process,
      you are giving your consent for the collection of the following
      Clean Insights measurements:
        - Installed OpenWISP Version
        - Enabled OpenWISP modules: A list of the enabled OpenWISP modules
          along with their respective versions
        - OS details: Information on the operating system, including its version, kernel version, and platform

      If you prefer not to participate, you can opt-out by configuring
      "openwisp2_clean_insights_measurement_consent: false" in your playbook.
      However, before making that decision, we encourage you to explore how this
      information contributes to the enhancement of OpenWISP at the following link:
      https://github.com/openwisp/openwisp-utils#clean-insights-measurements

      Should you wish to support us through data collection but prefer to disable
      this disclaimer, you can do so by setting
      "openwisp2_clean_insights_measurement_consent: true" in your playbook.
  when: "openwisp2_clean_insights_measurement_consent == None"
  tags: [ci_consent]

- name: Ensure user
  pause:
    seconds: 30
  when: "openwisp2_clean_insights_measurement_consent == None"
  tags: [ci_consent]

- import_tasks: apt.yml
  tags: [openwisp2, apt]

- import_tasks: ssh.yml
  tags: [openwisp2, ssh]

- name: Import system tasks
  import_tasks: system.yml
  tags: [openwisp2, system]

- import_tasks: pip.yml
  tags: [openwisp2, pip]

# comprises django_secret_key.yml
- import_tasks: django.yml
  tags: [openwisp2, django]

- import_tasks: freeradius.yml
  when: openwisp2_radius and openwisp2_freeradius_install
  tags: [openwisp2, freeradius]

- import_tasks: supervisor.yml
  tags: [openwisp2, supervisor]

- import_tasks: nginx.yml
  when: openwisp2_nginx_install
  tags: [openwisp2, nginx]

- import_tasks: cron.yml
  tags: [openwisp2, cron]

- import_tasks: complete.yml
  tags: [openwisp2]
